---
layout: post
title: AN HTTPDって覚えてる？ - 自宅サーバの思い出
tags: 自宅サーバ AdventCalendar
---

## はじめに

この記事は[自宅サーバの思い出 Advent Calendar 2016](http://www.adventar.org/calendars/1587)の4日目の記事です。

自宅サーバは思い出というか現在進行形で[立てています](https://j-ynv.net/)が、初めてサーバを立てた時からの記録を思い出せる限りで書こうと思います。

<!--more-->

## 最初は、ホームページでもっと多くのことをしたくて初めた

初めて自宅サーバを立てたのはかなり前になります。

契約していたプロバイダは地元ローカルな感じのやつだったので、
ホームページサービスは他の大手に比べれば出来ることは多かった（容量制限もゆるい、WebサーバはApacheでCGIも動く）のですが、
~~隠しページを作りたいとかそんな理由だったか~~Basic認証が使えるようなサーバが欲しいとか思っていました。

プロバイダの用意しているサーバでは.htaccessは使えないようになっていたので、他のホームページスペースのレンタルを探していました。

そこで見つけたのが現在でもサービスしている[XREA](https://www.xrea.com/)で、ここは共有SSLやBasic認証を利用することができました。
しかし、その代わりにCGIの実行制限が厳しめだったので当時ゲームCGIを設置していた自分にとっては代替になることはできませんでした。

こうして、「自宅でサーバを立てたい！」という願望が高まっていったわけです。
ひとまず、テスト（うまくいけば本番として）でサーバを立てるためにソフトを探していたところ出会ったのが、[AN HTTPD](https://ja.wikipedia.org/wiki/AN_HTTPD)でした。
これはWindows上で動作するWebサーバソフトウェアで、設定をすればActivePerlを使用してPerlなどで書かれたCGIを動かすことも可能でした。
Basic認証も設定可能で、ひとまず試してみることにしました。

しかし、LAN内からはアクセスできるのにグローバルIPを直接叩いてもアクセスできない・・・ポート開放はしているはずなのに？
となってしまって結構な間ハマってしまった覚えがあります
（今だからわかるけど、ヘアピンNAT非対応ルータを使うとこうなる）

他の人に外からアクセスしてもらって見えることがわかった瞬間、喜んだ覚えがあります。

AN HTTPDは当時では大半の要求を満たしていましたが、できなかったことの一つにSSLがありました。
Windows XP付属のIISなども試したのですが、ActivePerlを使うことによるCGIの動作互換性の問題もあったのでいっそのことLinuxのような環境で動かすか、という結論になりました。
また、ApacheをWindowsで動かすという選択肢もありましたが、ApacheでSSLはWindowsでは無理と当時は判断したという理由もあります
（Apacheも当時は1.3系で、Apache-SSLとmod_sslの2種類があり混沌としていた）
そうして入手したLinux環境はTurboLinux Workstation 8でした（地元の家電量販店で買った）

## 初代自宅サーバの誕生

ちょうど転がっていた、自宅に初めて来たパソコンである富士通の[DESKPOWER SIII167](http://www.fmworld.net/product/former/dp9706/lowspec.html)を自宅サーバとして使うことにしました。
中に入ってたWindows 95を消す前にイースターエッグ([The Microsoft Windows 95 Product Team!](https://www.youtube.com/watch?v=dtfBBNYdcPc))で遊んだ覚えがあります。

TurboLinux Workstation 8をインストールして自宅サーバとして稼働させていました。
しかしCPUが非力で、後に2代目に交代することになります。

## 2代目自宅サーバ

2代目の自宅サーバは、富士通の[ME3/505P](http://www.fmworld.net/product/former/dp0001/e_ser.html)でした。
最初はTurboLinuxを入れていたのですが、途中で~~何を考えていたのか~~FreeBSDで動かしていた時代もありました。
当時は5.0-RELEASEが出たあたりでした。

また、DynDNSのDDNSサービスから独自ドメイン(j-ynv.net)を取得して稼働させ始めたのもこの頃になります。
ynv.netが取れなかったからJapanを意味するj-を付けてこのドメインになったという経歴があります。

## 3代目自宅サーバ

割と最近まで稼働していたやつで、激安鯖として有名になったHPの[ML115 G1](http://wiki.nothing.sh/page/hp%BB%AA-ProLiant-ML115(%B3%CA%B0%C2Server))です。
この頃からOSがCentOSになりました。
+1万のOpteronのデュアルコアモデルを選んだことで、歴代自宅サーバ初のマルチコアマシンになりました。

## それ以降

現在動いているのは自作マシンです。
仮想化を視野に入れてコア数を盛るとなるとXeonではなかなかいい値段がするので、いっそのこと自作してしまいました。

まぁケチった結果ECCが無いのでメモリが死んだままサーバがかろうじて動作していた、なんてこともありましたが。

## ルータ選びの話

自宅にブロードバンド接続が来た頃はBUFFALOの安いルータを使っていましたが、接続が不安定で最悪な感じだったので割とすぐに別のルータにリプレースされました。
Coregaのルータも割と長く使いましたが、最終的に特定のアクションをするとPPPoE接続が切れる不具合に遭遇しリプレースの流れになりました。

そうして2007年かそれくらいの頃に入れたのがマイクロリサーチの[SuperOPT100E](http://www.mrl.co.jp/product/nwgopt100e/)で、これは落ちないルータと言われてる通りの性能を発揮しました。

特に問題なく使っていましたが、VLAN機能の貧弱さや6to4トンネルが掘れないという理由で現在はヤマハのRTX1210を使っています。

## 最後に

自宅サーバの構築を通してLinuxやネットワーク構築を学べた、と思っています。
たまに「ネットワークを学習したいならVPNを構築すればいい」と言っていますが、実際に手を動かしてみるのが結果的に良かったのではないかと思います。

またセキュリティについても、自宅サーバのセキュアな運用を調べることなどで副次的に興味を持つことになりました。

今では「自宅サーバなんて立てるもんじゃない、さもなくばサーバから出火してVPSを借りることになるぞ」と言われてたりしますが、やはりファイルサーバや録画サーバをやるとなるとどうしても自宅サーバが必要になるのです。
